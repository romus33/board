<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beres.to - Онлайн доска</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.7.0/math.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-paint-brush"></i>Beres.to. Онлайн доска с формулами, текстом и автофигурами</h1>
            <p class="subtitle">Рисуйте, добавляйте формулы и текст в реальном времени!</p>
        </header>
        
        <div class="info-box">
            <div class="board-info">
                <div>
                    <p><i class="fas fa-users"></i> <strong id="usersCount">1</strong> пользователей онлайн</p>
                </div>
                <div class="board-id-container">
                    <span><i class="fas fa-door-closed"></i> ID доски:</span>
                    <div class="board-id" id="boardIdDisplay" title="Нажмите, чтобы скопировать ID">Загрузка...</div>
                </div>
                <div class="board-actions">
                    <button class="btn-small btn-info" id="copyLinkBtn">
                        <i class="fas fa-copy"></i> Копировать ссылку
                    </button>
                    <button class="btn-small btn-primary" id="newBoardBtn">
                        <i class="fas fa-plus"></i> Новая доска
                    </button>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="canvas-container" id="canvas-container">
                <canvas id="drawingCanvas"></canvas>
                <canvas id="previewCanvas"></canvas>
                <div id="formulaOverlay" class="canvas-overlay"></div>
                <div id="textOverlay" class="canvas-overlay"></div>
            </div>
            
            <div class="tools-panel">
                <div class="panel-section">
                    <div class="mode-toggle">
                        <button class="mode-btn active" id="drawModeBtn">
                            <i class="fas fa-paint-brush"></i> Рисование
                        </button>
                        <button class="mode-btn" id="shapeModeBtn">
                            <i class="fas fa-shapes"></i> Фигуры
                        </button>
                        <button class="mode-btn" id="formulaModeBtn">
                            <i class="fas fa-square-root-alt"></i> Формулы
                        </button>
                        <button class="mode-btn" id="textModeBtn">
                            <i class="fas fa-font"></i> Текст
                        </button>
                        <button class="mode-btn" id="imageModeBtn">
                            <i class="fas fa-image"></i> Изображение
                        </button>     
                        <button class="mode-btn" id="graphModeBtn">
                            <i class="fas fa-chart-line"></i> График
                        </button>       

                    </div>
                </div>
                
                <div class="panel-section" id="drawingPanel">
                    <h3 class="tool-title"><i class="fas fa-palette"></i> Рисование</h3>
                    <div class="color-picker">
                        <div class="color-option active" style="background-color: #000000;" data-color="#000000"></div>
                        <div class="color-option" style="background-color: #ff0000;" data-color="#ff0000"></div>
                        <div class="color-option" style="background-color: #00ff00;" data-color="#00ff00"></div>
                        <div class="color-option" style="background-color: #0000ff;" data-color="#0000ff"></div>
                        <div class="color-option" style="background-color: #ffff00;" data-color="#ffff00"></div>
                        <div class="color-option" style="background-color: #ff00ff;" data-color="#ff00ff"></div>
                        <div class="color-option" style="background-color: #00ffff;" data-color="#00ffff"></div>
                        <div class="color-option" style="background-color: #ff9900;" data-color="#ff9900"></div>
                        <div class="color-option" style="background-color: #9900ff;" data-color="#9900ff"></div>
                        <div class="color-option" style="background-color: #ffffff; border: 1px solid #ccc;" data-color="#ffffff"></div>
                    </div>
                    
                    <div class="tool-title"><i class="fas fa-brush"></i> Размер кисти</div>
                    <div class="brush-sizes">
                        <div class="brush-size active" data-size="2">•</div>
                        <div class="brush-size" data-size="5">••</div>
                        <div class="brush-size" data-size="10">•••</div>
                        <div class="brush-size" data-size="15">••••</div>
                        <div class="brush-size" data-size="20">•••••</div>
                    </div>
                </div>
                
                <div class="panel-section" id="shapesPanel" style="display: none;">
                    <h3 class="tool-title"><i class="fas fa-shapes"></i> Автофигуры</h3>
                    <div class="shape-buttons">
                        <div class="shape-btn" data-shape="line"><div class="shape-icon">─</div><div>Прямая</div></div>
                        <div class="shape-btn" data-shape="circle"><div class="shape-icon">○</div><div>Круг</div></div>
                        <div class="shape-btn" data-shape="square"><div class="shape-icon">□</div><div>Квадрат</div></div>
                        <div class="shape-btn" data-shape="rectangle"><div class="shape-icon">▭</div><div>Прямоугольник</div></div>
                        <div class="shape-btn" data-shape="triangle"><div class="shape-icon">△</div><div>Треугольник</div></div>
                        <div class="shape-btn" data-shape="equilateral"><div class="shape-icon">△</div><div>Равносторонний</div></div>
                        <div class="shape-btn" data-shape="right"><div class="shape-icon">⊿</div><div>Прямоугольный</div></div>
                        <div class="shape-btn" data-shape="isosceles"><div class="shape-icon">∆</div><div>Равнобедренный</div></div>
                        <div class="shape-btn" data-shape="obtuse"><div class="shape-icon">△</div><div>Тупоугольный</div></div>
                        <div class="shape-btn" data-shape="diamond"><div class="shape-icon">◇</div><div>Ромб</div></div>
                        <div class="shape-btn" data-shape="arrow"><div class="shape-icon">→</div><div>Стрелка</div></div>
                        <div class="shape-btn" data-shape="cube"><div class="shape-icon">□</div><div>Куб</div></div>
                        <div class="shape-btn" data-shape="parallelepiped"><div class="shape-icon">▯</div><div>Параллелепипед</div></div>
                        <div class="shape-btn" data-shape="pyramid"><div class="shape-icon">△</div><div>Пирамида</div></div>
    <div class="shape-btn" data-shape="trapezoid"><div class="shape-icon">⏢</div><div>Трапеция</div></div>
    <div class="shape-btn" data-shape="ellipse"><div class="shape-icon">⬭</div><div>Эллипс</div></div>
    <div class="shape-btn" data-shape="hexagon"><div class="shape-icon">⬢</div><div>Шестиугольник</div> </div>                       
                    </div>
                    
                    <!-- Добавленный блок управления вращением -->
                    <div class="rotation-controls" style="margin-top: 15px; display: none;" id="rotationControls">
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button class="btn-small btn-info" id="rotateLeftBtn" title="Повернуть на 5° влево">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button class="btn-small btn-info" id="rotateRightBtn" title="Повернуть на 5° вправо">
                                <i class="fas fa-redo"></i>
                            </button>
                            <button class="btn-small btn-warning" id="resetRotationBtn" title="Сбросить вращение">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="shape-info" id="shapeInfo">Выберите фигуру и рисуйте на холсте</div>
                </div>
                
                <div class="panel-section" id="formulasPanel" style="display: none;">
                    <h3 class="tool-title"><i class="fas fa-square-root-alt"></i> Формулы LaTeX</h3>
                    
                    <div class="formula-preview" id="formulaPreview">
                        <div class="latex-output">Введите формулу для предпросмотра</div>
                    </div>
                    
                    <textarea class="latex-textarea" id="latexInput" 
                        placeholder="Введите формулу LaTeX (например: E = mc^2 или многострочную формулу)"
                        rows="4"></textarea>
                    
                    <div class="controls">
                        <button class="btn btn-primary" id="addFormulaBtn">
                            <i class="fas fa-plus-circle"></i> Добавить формулу
                        </button>
                        <button class="btn btn-warning" id="clearFormulaBtn">
                            <i class="fas fa-backspace"></i> Очистить поле
                        </button>
                    </div>
                    
                    <div class="formula-examples">
                        <p>Примеры формул:</p>
                        <div class="formula-example" onclick="insertExample('E = mc^2')">E = mc^2</div>
                        <div class="formula-example" onclick="insertExample('\\frac{a}{b}')">\frac{a}{b} - Дробь</div>
                        <div class="formula-example" onclick="insertExample('\\sqrt{x^2 + y^2}')">\sqrt{x^2 + y^2} - Корень</div>
                        <div class="formula-example" onclick="insertExample('\\sum_{i=1}^{n} i = \\frac{n(n+1)}{2}')">\sum_{i=1}^{n} i - Сумма</div>
                        <div class="formula-example" onclick="insertExample('\\int_{a}^{b} f(x) dx')">\int_{a}^{b} f(x) dx - Интеграл</div>
                        <div class="formula-example" onclick="insertExample('E = \\hbar\\omega')">E = \hbar \omega - Уравнение Планка</div>
                        <div class="formula-example" onclick="insertExample('\\begin{cases} 2 |x| \\cdot (2 - x) = a, \\\\ x < 2, \\\\ x \\ne 0. \\end{cases}')"> \\begin{cases}2 |x| \cdot (2 - x) = a,\\x < 2,\\x \ne 0.\\end{cases} - Система уравнений</div>
                        <div class="formula-example" onclick="insertExample('\\vec{r} = \\vec{r_0}+\\vec{v}t+\\frac{\\vec{a}t^2}{2}')"> \vec{r} = \vec{r_0} + \vec{v}t + \frac{\vec{a} t^2}{2} Векторы</div>
                        <div class="formula-example" onclick="insertExample('\\mathbf{v_1} = \\mathbf{v_2} - \\mathbf{v_0}')"> \mathbf{v_1} = \mathbf{v_2} - \mathbf{v_0} Жирные векторы</div>
                        <div class="formula-example" onclick="insertExample('\\vec{\\nabla} \\times \\vec{H} = \\vec{J} + \\frac{\\partial{\\vec{D}}}{\\partial{t}}')"> \vec{\nabla} \times \vec{H} = \vec{J} + \frac{\partial{\vec{D}}}{\partial{t}}
 Уравнение Максвелла</div>
                        <div class="formula-example" onclick="insertExample('\\oint_L \\vec{H} \\cdot d\\vec{l} = \\iint_S \\vec{J} \\cdot d\\vec{A} + \\iint_S \\frac{\\partial\\vec{D}}{\\partial t} \\cdot d\\vec{A}')">\oint_L \vec{H} \cdot d\vec{l} = \iint_S \vec{J} \cdot d\vec{A} + \iint_S \frac{\partial\vec{D}}{\partial t} \cdot d\vec{A}  Уравнение Максвелла</div>

                        <div class="formula-example" onclick="insertExample('i\\hbar\\frac{\\partial\\Psi(\\mathbf{r}, t)}{\\partial t} = \\left(-\\frac{\\hbar^2}{2m}\\nabla^2 + V(\\mathbf{r}, t)\\right)\\Psi(\\mathbf{r}, t)')">i\hbar\frac{\partial \Psi(\mathbf{r}, t)}{\partial t} = \left(-\frac{\hbar^2}{2m}\nabla^2 + V(\mathbf{r}, t)\right) \Psi(\mathbf{r}, t)
  Уравнение Шредингера</div>
                    </div>
                </div>
                
                <div class="panel-section" id="textPanel" style="display: none;">
                    <h3 class="tool-title"><i class="fas fa-font"></i> Текст</h3>
                    
                    <div class="text-settings">
                        <select class="text-size-select" id="textSizeSelect">
                            <option value="12px">Маленький</option>
                            <option value="16px" selected>Средний</option>
                            <option value="20px">Большой</option>
                            <option value="24px">Очень большой</option>
                            <option value="32px">Заголовок</option>
                        </select>
                        
                        <select class="text-font-select" id="textFontSelect">
                            <option value="Arial, sans-serif" selected>Arial</option>
                            <option value="'Times New Roman', serif">Times New Roman</option>
                            <option value="'Courier New', monospace">Courier New</option>
                            <option value="Georgia, serif">Georgia</option>
                            <option value="Verdana, sans-serif">Verdana</option>
                        </select>
                    </div>
                    
                    <textarea class="text-textarea" id="textInput" 
                        placeholder="Введите текст (поддерживается многострочный текст)"
                        rows="4"></textarea>
                    
                    <div class="controls">
                        <button class="btn btn-primary" id="addTextBtn">
                            <i class="fas fa-plus-circle"></i> Добавить текст
                        </button>
                        <button class="btn btn-warning" id="clearTextBtn">
                            <i class="fas fa-backspace"></i> Очистить поле
                        </button>
                    </div>
                    
                    <div class="formula-examples">
                        <p>Примеры использования:</p>
                        <div class="formula-example" onclick="insertTextExample('Заголовок\n---\nОсновной текст')">Многострочный текст</div>
                        <div class="formula-example" onclick="insertTextExample('Список:\n1. Первый пункт\n2. Второй пункт\n3. Третий пункт')">Список</div>
                        <div class="formula-example" onclick="insertTextExample('Примечание: важная информация')">Примечание</div>
                    </div>
                </div>
                
                <div class="panel-section" id="imagePanel" style="display: none;">
                    <h3 class="tool-title"><i class="fas fa-image"></i> Картинка</h3>

                    <input type="file" id="imageUpload" accept="image/*"
                        style="padding: 10px; background: white; border-radius: 10px; color: black; width: 100%; margin-bottom: 10px;">

                    <div class="controls">
                        <button class="btn btn-primary" id="addImageBtn">
                            <i class="fas fa-plus-circle"></i> Добавить изображение
                        </button>
                    </div>

                    <p style="font-size: 0.9rem; opacity: 0.9; margin-top: 10px;">
                        После добавления изображение можно перетаскивать мышью. Для масштабирования используйте колесико мыши.
                    </p>
                </div>


<div class="panel-section" id="graphPanel" style="display: none;">
    <h3 class="tool-title"><i class="fas fa-chart-line"></i> Построение графика</h3>
    
    <div class="graph-inputs" style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px;">
        <input type="text" id="graphFunction" 
               placeholder="Введите функцию (например: sin(x) или x^2)"
               style="padding: 10px; border-radius: 5px; border: 2px solid rgba(255,255,255,0.3); 
                      background: rgba(255,255,255,0.9); color: #000; width: 100%;">
        
        <div style="display: flex; gap: 10px;">
            <input type="number" id="graphXMin" placeholder="X мин" value="-10" step="0.1"
                   style="flex: 1; padding: 10px; border-radius: 5px; border: 2px solid rgba(255,255,255,0.3); 
                          background: rgba(255,255,255,0.9); color: #000; width: 50%;">
            <input type="number" id="graphXMax" placeholder="X макс" value="10" step="0.1"
                   style="flex: 1; padding: 10px; border-radius: 5px; border: 2px solid rgba(255,255,255,0.3); 
                          background: rgba(255,255,255,0.9); color: #000; width: 50%;">
        </div>
        
        <div style="display: flex; gap: 10px;">
            <input type="number" id="graphYMin" placeholder="Y мин" value="-5" step="0.1"
                   style="flex: 1; padding: 10px; border-radius: 5px; border: 2px solid rgba(255,255,255,0.3); 
                          background: rgba(255,255,255,0.9); color: #000; width: 50%;">
            <input type="number" id="graphYMax" placeholder="Y макс" value="5" step="0.1"
                   style="flex: 1; padding: 10px; border-radius: 5px; border: 2px solid rgba(255,255,255,0.3); 
                          background: rgba(255,255,255,0.9); color: #000; width: 50%;">
        </div>
        
        <div style="display: flex; align-items: center; gap: 10px;">
            <label style="color: white; font-size: 0.9rem;">Цвет:</label>
            <input type="color" id="graphColor" value="#ff0000" 
                   style="width: 50px; height: 30px; cursor: pointer;">
            <label style="color: white; font-size: 0.9rem; margin-left: 10px;">Толщина:</label>
            <input type="range" id="graphLineWidth" min="1" max="5" value="2" 
                   style="flex: 1; height: 5px;">
        </div>
    </div>
    
    <div id="graphPreview" 
         style="width: 100%; height: 200px; background: white; border-radius: 8px; margin-bottom: 15px;"></div>
    
    <div class="controls">
        <button class="btn btn-primary" id="plotGraphBtn">
            <i class="fas fa-plus-circle"></i> Построить график
        </button>
        <button class="btn btn-warning" id="clearGraphBtn">
            <i class="fas fa-backspace"></i> Очистить
        </button>
    </div>
    
    <div class="formula-examples" style="margin-top: 15px;">
        <p>Примеры функций:</p>
        <div class="formula-example" onclick="insertGraphExample('sin(x/PI)')">sin(x/PI) - Синус</div>
        <div class="formula-example" onclick="insertGraphExample('cos(x)')">cos(x) - Косинус</div>
        <div class="formula-example" onclick="insertGraphExample('x^2')">x^2 - Квадратичная</div>
        <div class="formula-example" onclick="insertGraphExample('log(x)')">log(x) - Логарифм</div>
        <div class="formula-example" onclick="insertGraphExample('exp(x)')">exp(x) - Экспонента</div>
        <div class="formula-example" onclick="insertGraphExample('abs(x)')">abs(x) - Модуль</div>
        <div class="formula-example" onclick="insertGraphExample('1/x')">1/x - Гипербола</div>
         <div class="formula-example" onclick="insertGraphExample('sqrt(x)')">sqrt(x) - Корень</div>
         <div class="formula-example" onclick="insertGraphExample('cbrt(x)')">cbrt(x) - Кубический корень</div>
    </div>
</div>                 
               
                
                <div class="panel-section">
                    <h3 class="tool-title"><i class="fas fa-sliders-h"></i> Управление</h3>
                    <div class="controls">
                        <button class="btn btn-primary" id="clearBtn">
                            <i class="fas fa-trash-alt"></i> Очистить доску
                        </button>
                        <button class="btn btn-warning" id="undoBtn">
                            <i class="fas fa-undo"></i> Отменить
                        </button>
                        <button class="btn btn-info" id="saveBtn">
                            <i class="fas fa-download"></i> Сохранить
                        </button>
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3 class="tool-title"><i class="fas fa-users"></i> Онлайн (<span id="liveUsersCount">1</span>)</h3>
                    <div class="users-list" id="usersList">
                        <div class="user-item">
                            <div class="user-color" style="background: #4CAF50;"></div>
                            <span>Вы</span>
                        </div>
                    </div>
                </div>
                
                <div class="status connected" id="connectionStatus">
                    <i class="fas fa-wifi"></i> Подключено к серверу
                </div>
            </div>
        </div>
        
        <footer>
            <p>Рисуйте, добавляйте формулы и текст вместе с друзьями! Все изменения видны в реальном времени.</p>
            <p><i class="fa-solid fa-caret-left"></i><i class="fa-solid fa-computer-mouse"></i> - рисовать, <i class="fa-solid fa-computer-mouse"></i><i class="fa-solid fa-caret-right"></i> - ластик, Enter - добавить формулу/текст, Delete - удалить выбранное</p>
            <p>Для вращения фигур: перетащите маркер вращения или используйте клавиши [ ] \</p>
        </footer>
    </div>

    <script src = "{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
